trigger:
  - main

pr:
  - main

pool:
  vmImage: ubuntu-latest

strategy:
  matrix:
    Python36:
      python.version: '3.6'
    Python37:
      python.version: '3.7'
    Python38:
      python.version: '3.8'
    Python39:
      python.version: '3.9'
    Python310:
      python.version: '3.10'

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '$(python.version)'
    displayName: 'Use Python $(python.version)'
  # Run tox
  - script: |
      python -m pip install --upgrade pip
      pip install tox
    displayName: 'Install dependencies'
  - script: 'tox -e py'
    displayName: Run Tox
  # Publish test results and code coverage report
  - task: PublishTestResults@2
    displayName: Publish test results
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: '$(Build.SourcesDirectory)/junit/test_results.xml'
  - task: PublishCodeCoverageResults@1
    displayName: Publish code coverage results
    inputs:
      codeCoverageTool: 'cobertura'
      summaryFileLocation: '$(Build.SourcesDirectory)/junit/coverage-reports/coverage.xml'
      pathToSources: '$(Build.SourcesDirectory)/src/'
